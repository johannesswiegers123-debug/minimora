{% schema %}
{
  "name": "Eco Packaging",
  "target": "section",
  "settings": []
}
{% endschema %}

<style>
  .eco-packaging-wrapper { margin: 1rem 0; }
  .eco-packaging-title { margin: 0 0 0.5rem 0; font-weight: 600; }
  .eco-packaging-description { margin: 0 0 1rem 0; }

  .eco-packaging-toggle { display: none; }
  .eco-packaging-toggle-label { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; }
  .eco-packaging-toggle-slider { width: 46px; height: 26px; background: #ccc; border-radius: 26px; position: relative; transition: background 0.2s; }
  .eco-packaging-toggle-slider::before { content: ''; position: absolute; width: 22px; height: 22px; background: #fff; border-radius: 50%; top: 2px; left: 2px; transition: left 0.2s; }
  .eco-packaging-toggle:checked + .eco-packaging-toggle-label .eco-packaging-toggle-slider { background: #28a745; }
  .eco-packaging-toggle:checked + .eco-packaging-toggle-label .eco-packaging-toggle-slider::before { left: 22px; }

  .eco-packaging-hint { margin: 0.5rem 0 0 0; font-size: 0.9rem; color: inherit; opacity: 0.9; }
</style>

<div class="eco-packaging-wrapper" data-eco-packaging-block>
  <h3 class="eco-packaging-title">ðŸ’š
    <span class="eco-lang-en" style="display:block">Save packaging, save 5%</span>
    <span class="eco-lang-da" style="display:none">Spare emballage, spar 5%</span>
  </h3>

  <p class="eco-packaging-description">
    <span class="eco-lang-en" style="display:block">Choose minimal packaging to reduce waste. You get a discount.</span>
    <span class="eco-lang-da" style="display:none">VÃ¦lg minimalt emballage for at reducere affald. Du fÃ¥r rabat.</span>
  </p>

  <div class="eco-packaging-option">
    <input type="checkbox" id="eco-packaging-toggle-{{ section.id }}" class="eco-packaging-toggle" data-eco-packaging-toggle onchange="window.ecoPackaging && window.ecoPackaging.handleToggle(this.checked, '{{ section.id }}')">
    <label for="eco-packaging-toggle-{{ section.id }}" class="eco-packaging-toggle-label">
      <span class="eco-packaging-toggle-slider" aria-hidden="true"></span>
      <span class="eco-packaging-label-text">
        <span class="eco-lang-en" style="display:block">Enable minimal packaging (5% off)</span>
        <span class="eco-lang-da" style="display:none">Aktiver minimalt emballage (5% rabat)</span>
      </span>
    </label>
  </div>

  <p class="eco-packaging-hint">
    <span class="eco-lang-en" style="display:block">Help reduce waste and get a discount!</span>
    <span class="eco-lang-da" style="display:none">HjÃ¦lp med at reducere affald og fÃ¥ rabat!</span>
  </p>

  <script type="application/json" id="eco-packaging-config-{{ section.id }}" data-eco-packaging-config>
  {
    "sectionId": "{{ section.id }}"
  }
  </script>

  <script>
    (function () {
      const wrapper = document.querySelector('[data-eco-packaging-block]');
      if (!wrapper) return;

      function setLanguage(lang) {
        const isDA = lang === 'da';
        wrapper.querySelectorAll('.eco-lang-en').forEach(el => el.style.display = isDA ? 'none' : 'block');
        wrapper.querySelectorAll('.eco-lang-da').forEach(el => el.style.display = isDA ? 'block' : 'none');
      }

      const storedLang = (typeof localStorage !== 'undefined' && localStorage.getItem('eco_packaging_language')) || 'en';
      setLanguage(storedLang);

      window.addEventListener('storage', (e) => {
        if (e.key === 'eco_packaging_language') setLanguage(e.newValue || 'en');
      });
    })();
  </script>
</div>
